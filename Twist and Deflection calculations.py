''' This script calculates the deflection and twist of a wing box cross section'''
# Keeping time and imports ------------------------------------------------------------------
import time
start_time = time.time()

import math
import numpy as np
import matplotlib.pyplot as plt
import scipy as sp
from scipy import interpolate
from scipy import integrate

# Inputs ------------------------------------------------------------------------------------


# Given by the previous iterations
C_r = 3.695625413           # Root chord            [m]
C_t = 1.107118055           # Tip chord             [m]
b = 24.01371734             # Wing span             [m]
x_frontspar = 0.20          # Front spar position   [%]
x_rearspar = 0.60           # Rear spar position    [%]
h_frontspar = 0.0908        # Front spar height     [%]
h_rearspar = 0.0804         # Rear spar height      [%]

T_engine = 21244            # Engine thrust         [N] FILLER
V = 228.31                  # Max speed             [m/s]

n = 2.5                     # Load factor           [-]

# ---DESIGN CHOICES---

# Material properties (Al-4047)
E = 72 * 10**9              # E-modulus of material [Pa]
G = 27 * 10**9              # G-modulus of material [Pa]
rho = 2660                  # Density of material   [kg/m^3]

# Thickness and area design choices                 [FILLERS]
t_sheet_spar = 0.005        # Spar thickness        [m]
t_sheet_hor = 0.005         # Horizontal sheets thickness [m]
A_str = 8*10**-5            # Area of a stringer    [m^2] 2cm x 2mm x 2

# Stringers design choices                          [FILLERS]
''' To insert stringers on your desired location, you first set the intervals at which
the stringers will vary, using distance_top. Then in the stringers_top array you input
the stringer location as % of the chord. With a spacing of [0.25, 0.5, 1] for example,
and locations [[0.2, 0.2, 0.2], [0.4, 0.4, 0], [0.6, 0, 0], [0.8, 0.8, 0.8]], there
will be 4 stringers located at [0.2, 0.4, 0.6, 0.8] percent of the chord up until 25%
of the span. Then until 50% it will look like [0.2, 0.4, 0.8] etc.'''

distance_top = np.array([0.25, 0.75, 1])             # Interval of stringer variance [%span]
stringers_top = np.array([[0.2, 0.2, 0.2], [0.4, 0.4, 0], [0.6, 0, 0], [0.8, 0.8, 0.8]])
topstr = sp.interpolate.interp1d(distance_top,stringers_top,kind='next',fill_value='extrapolate')

distance_bot = np.array([0.25, 0.5, 1])             # Interval of stringer variance [%span]
stringers_bot = np.array([[0.2, 0.2, 0.2], [0.4, 0.4, 0], [0.6, 0, 0], [0.8, 0.8, 0.8]])
botstr = sp.interpolate.interp1d(distance_bot,stringers_bot,kind='next',fill_value='extrapolate')


# Lift and moment distribution ---------------------------------------------------------------

Ldistr = [12788.369448270327, 12788.400682920008, 12788.494380185548, 12788.650520016414, 12788.869068995093, 12789.149980337026, 12789.49319389067, 12789.898636137454, 12790.366220191787, 12790.895845801084, 12791.48739934574, 12792.140753839125, 12792.855768927628, 12793.632290890586, 12794.470152640355, 12795.369173722254, 12796.329160314624, 12797.349905228757, 12798.43118790894, 12799.572774432472, 12800.774417509614, 12802.035856483619, 12803.35681733074, 12804.737012660204, 12806.176141714226, 12807.673890368023, 12809.229931129777, 12810.843923140685, 12812.515512174901, 12814.244330639596, 12816.029997574906, 12817.872118653966, 12819.770286182897, 12821.724079100806, 12823.73306297978, 12825.796790024906, 12827.91479907426, 12830.086615598895, 12832.311751702853, 12834.589706123172, 12836.919964229864, 12839.301998025947, 12841.735192203585, 12844.21811098082, 12846.748816181216, 12849.325362368561, 12851.945804936653, 12854.608200811734, 12857.310609142543, 12860.05109197818, 12862.827714933666, 12865.638547843257, 12868.481665401434, 12871.355147791639, 12874.257081302796, 12877.185558933474, 12880.13868098383, 12883.114555635271, 12886.111299517808, 12889.127038265202, 12892.15990705779, 12895.208051153042, 12898.269626403851, 12901.342799764587, 12904.425749784792, 12907.516667090691, 12910.613754854377, 12913.715229250767, 12916.819319902219, 12919.924270310947, 12923.028338279111, 12926.12979631667, 12929.22693203695, 12932.318048539919, 12935.401464783214, 12938.475515940912, 12941.53855374998, 12944.588946844473, 12947.625081077493, 12950.645359830803, 12953.648204312267, 12956.632053840898, 12959.595366119767, 12962.536617496495, 12965.454303211613, 12968.346937634531, 12971.213054487336, 12974.051207056216, 12976.859968390692, 12979.637931490563, 12982.383709480535, 12985.095935772593, 12987.77326421618, 12990.41436923596, 12993.017945957425, 12995.582710320188, 12998.10739917899, 13000.590770392466, 13003.031602899617, 13005.42869678399, 13007.780873325644, 13010.086975040776, 13012.345865709156, 13014.556430389172, 13016.717575420715, 13018.828228415745, 13020.887338236562, 13022.893874961868, 13024.846829840453, 13026.745215232748, 13028.58806453996, 13030.37443212107, 13032.103393197423, 13033.774043745167, 13035.385500375336, 13036.936900201707, 13038.427400696366, 13039.856179533, 13041.222434417892, 13042.525382908749, 13043.764262221084, 13044.938329022494, 13046.046859214533, 13047.089147702445, 13048.064517876837, 13048.972858944337, 13049.814894699948, 13050.591411106097, 13051.303186494059, 13051.950991640437, 13052.5355898426, 13053.05773699302, 13053.518181652365, 13053.917665121684, 13054.25692151334, 13054.536677820888, 13054.75765398785, 13054.920562975354, 13055.026110828709, 13055.074996742847, 13055.067913126666, 13055.005545666223, 13054.888573386914, 13054.717668714457, 13054.493497534808, 13054.216719252998, 13053.887986850774, 13053.507946943238, 13053.077239834316, 13052.59649957113, 13052.066353997248, 13051.48742480493, 13050.860327586064, 13050.185671882226, 13049.46406123344, 13048.696093225992, 13047.882359538984, 13047.0234459899, 13046.119932579031, 13045.172393532772, 13044.181397345785, 13043.147506822144, 13042.071279115338, 13040.953265767095, 13039.794012745197, 13038.594060480149, 13037.353943900698, 13036.074192468363, 13034.755330210715, 13033.397875753648, 13032.00234235252, 13030.569237922145, 13029.099065065771, 13027.592321102833, 13026.049498095696, 13024.471082875272, 13022.857557065448, 13021.209397106559, 13019.527074277587, 13017.81105471739, 13016.061799444737, 13014.279764377292, 13012.465400349447, 13010.619153129068, 13008.741463433167, 13006.832766942362, 13004.893494314394, 13002.924071196376, 13000.924918236042, 12998.896451091807, 12996.839080441847, 12994.7532119919, 12992.639246482102, 12990.497579692674, 12988.328602448431, 12986.132700622327, 12983.910255137742, 12981.6616419698, 12979.387232145436, 12977.087391742501, 12974.762481887643, 12972.412858753167, 12970.038873552738, 12967.640872535965, 12965.219196981943, 12962.774183191652, 12960.306125562709, 12957.81507600639, 12955.300991531185, 12952.763830032343, 12950.20355054076, 12947.620113224908, 12945.0134793928, 12942.383611493848, 12939.73047312068, 12937.054029010882, 12934.354245048631, 12931.631088266404, 12928.884526846434, 12926.114530122277, 12923.321068580211, 12920.504113860596, 12917.663638759197, 12914.799617228402, 12911.912024378445, 12909.000836478464, 12906.0660309576, 12903.107586405986, 12900.125482575635, 12897.119700381361, 12894.09022190154, 12891.03703037888, 12887.960110221087, 12884.859447001469, 12881.735027459514, 12878.586839501371, 12875.414872200272, 12872.219115796895, 12868.999561699682, 12865.756202485069, 12862.489031897663, 12859.198044850353, 12855.883237424394, 12852.544606869362, 12849.182151603061, 12845.795871211458, 12842.385766448442, 12838.95183923553, 12835.494092661642, 12832.0125309826, 12828.507159620756, 12824.977985164469, 12821.42501536751, 12817.848259148426, 12814.247726589894, 12810.62342893787, 12806.97537860085, 12803.303589148938, 12799.608075312904, 12795.888852983173, 12792.14593920877, 12788.379352196143, 12784.589111308009, 12780.77523706205, 12776.937751129617, 12773.076676334349, 12769.192036650693, 12765.2838572024, 12761.352164260974, 12757.396985244017, 12753.418348713514, 12749.416284374107, 12745.390823071224, 12741.341996789235, 12737.269838649483, 12733.17438290824, 12729.055664954714, 12724.913721308798, 12720.748589618977, 12716.560308659979, 12712.348918330516, 12708.114459650847, 12703.85697476035, 12699.576506915004, 12695.273100484805, 12690.94680095114, 12686.597657290893, 12682.225740597993, 12677.831132990443, 12673.41391619956, 12668.97417146879, 12664.511979554618, 12660.027420727483, 12655.520574772587, 12650.991520990821, 12646.440338199578, 12641.867104733628, 12637.271898445917, 12632.654796708444, 12628.015876413032, 12623.355213972169, 12618.672885319796, 12613.968965912098, 12609.243530728312, 12604.496654271465, 12599.728410569165, 12594.938873174344, 12590.128115166035, 12585.296209150054, 12580.443227259799, 12575.569241156916, 12570.674322032057, 12565.758540605531, 12560.821967128073, 12555.86467138145, 12550.886722679195, 12545.888189867243, 12540.869141324622, 12535.82964496408, 12530.769768232736, 12525.689578112699, 12520.589141121725, 12515.468523313795, 12510.327790279754, 12505.16700714789, 12499.986238584517, 12494.785548794585, 12489.56500152221, 12484.324660051285, 12479.064587205989, 12473.784845351352, 12468.485496393805, 12463.16660178168, 12457.828222505737, 12452.470419099685, 12447.093251640685, 12441.69677974981, 12436.281062592574, 12430.846158879345, 12425.392126865896, 12419.919024353785, 12414.426908690824, 12408.915836771548, 12403.385865037611, 12397.83704947822, 12392.26944563054, 12386.683108580102, 12381.078092961217, 12375.45445295732, 12369.812242301385, 12364.151514276267, 12358.472321715091, 12352.774717001574, 12347.058752070372, 12341.32447840742, 12335.57194705027, 12329.801208588366, 12324.01231316339, 12318.205310469539, 12312.380249753814, 12306.537179816309, 12300.676149010484, 12294.797205243402, 12288.900395976023, 12282.98576777198, 12277.053359849013, 12271.103205867008, 12265.135339381208, 12259.14979399189, 12253.146603344283, 12247.125801128443, 12241.087421079179, 12235.031496975971, 12228.958062642832, 12222.86715194824, 12216.758798805042, 12210.633037170352, 12204.489901045428, 12198.329424475642, 12192.15164155031, 12185.956586402637, 12179.744293209611, 12173.5147961919, 12167.268129613765, 12161.00432778295, 12154.723425050604, 12148.42545581116, 12142.110454502259, 12135.778455604637, 12129.42949364204, 12123.063603181108, 12116.680818831312, 12110.281175244809, 12103.864707116387, 12097.431449183347, 12090.981436225415, 12084.51470306462, 12078.031284565217, 12071.5312156336, 12065.014531218185, 12058.481266309307, 12051.931455939142, 12045.365135181592, 12038.782339152185, 12032.183103008012, 12025.567461947567, 12018.935451210715, 12012.28710607854, 12005.62246187328, 11998.941553958202, 11992.244417737538, 11985.531088656344, 11978.801602200441, 11972.0559938963, 11965.294299310919, 11958.516554051774, 11951.722793766668, 11944.913054143686, 11938.087370911027, 11931.245779836989, 11924.38831672979, 11917.515017437525, 11910.625917848027, 11903.721053888814, 11896.800461526927, 11889.86417676889, 11882.912235660582, 11875.94467428713, 11868.96152877283, 11861.962835281032, 11854.948630014049, 11847.91894921306, 11840.873829157987, 11833.813306167427, 11826.737416598538, 11819.646196846916, 11812.539683346544, 11805.417912569645, 11798.280921026608, 11791.128745265894, 11783.961419738152, 11776.77896819612, 11769.581410993547, 11762.36876842167, 11755.141060710383, 11747.898308028283, 11740.64053048271, 11733.367748119823, 11726.079980924616, 11718.777248821008, 11711.459571671849, 11704.126969279003, 11696.779461383381, 11689.41706766498, 11682.039807742955, 11674.647701175647, 11667.240767460653, 11659.81902603484, 11652.38249627443, 11644.93119749501, 11637.465148951625, 11629.984369838781, 11622.488879290508, 11614.978696380424, 11607.453840121758, 11599.9143294674, 11592.360183309953, 11584.791420481792, 11577.208059755085, 11569.610119841842, 11561.997619393984, 11554.370577003368, 11546.729011201825, 11539.072940461245, 11531.402383193557, 11523.717357750827, 11516.017882425303, 11508.303975449413, 11500.57565499585, 11492.832939177617, 11485.075846048032, 11477.30439360082, 11469.518599770125, 11461.718482430555, 11453.904059397248, 11446.075348425873, 11438.232367212744, 11430.375133394762, 11422.503664549555, 11414.617978195458, 11406.718091791581, 11398.804022737839, 11390.875788375006, 11382.933405984744, 11374.976892789651, 11367.006265953309, 11359.021542580313, 11351.022739716302, 11343.009874348032, 11334.982963403401, 11326.942023751457, 11318.887072202502, 11310.81812550807, 11302.73520036102, 11294.638313395528, 11286.527481187144, 11278.402720252861, 11270.264047051105, 11262.111477981809, 11253.94502938644, 11245.764717548012, 11237.57055869118, 11229.362568971106, 11221.140763146368, 11212.905153370228, 11204.655751546876, 11196.392569634041, 11188.11561964293, 11179.824913638238, 11171.520463738112, 11163.202282114087, 11154.870380991126, 11146.524772647565, 11138.16546941505, 11129.79248367857, 11121.405827876386, 11113.005514500039, 11104.591556094294, 11096.16396525713, 11087.722754639706, 11079.26793694633, 11070.799524934451, 11062.317531414606, 11053.821969250423, 11045.312851358542, 11036.79019070866, 11028.254000323428, 11019.704293278493, 11011.141082702408, 11002.564381776649, 10993.974203735548, 10985.370561866328, 10976.753469508982, 10968.12294005633, 10959.47898695394, 10950.821623700103, 10942.150863845849, 10933.466720994862, 10924.769208803471, 10916.058340980622, 10907.334131287862, 10898.596593539292, 10889.845741601534, 10881.081589393707, 10872.304150887416, 10863.513440106695, 10854.709471127988, 10845.892258080105, 10837.061815144236, 10828.21815655385, 10819.361296594736, 10810.491249604927, 10801.608029974668, 10792.711652146418, 10783.802130614804, 10774.879479926562, 10765.943714680545, 10756.994849527684, 10748.03289917092, 10739.05787836523, 10730.069801917547, 10721.06868468676, 10712.054541583662, 10703.027387570919, 10693.98723766306, 10684.934106926406, 10675.868010479086, 10666.788963490946, 10657.696981183592, 10648.59207883027, 10639.4742717559, 10630.34357533466, 10621.199999822167, 10612.0435394102, 10602.874185247387, 10593.691928580116, 10584.496760752556, 10575.288673206689, 10566.067657482296, 10556.833705217015, 10547.586808146332, 10538.326958103615, 10529.054147020146, 10519.768366925104, 10510.469609945638, 10501.157868306842, 10491.833134331791, 10482.495400441594, 10473.14465915536, 10463.780903090259, 10454.40412496153, 10445.014317582527, 10435.611473864685, 10426.19558681761, 10416.76664954907, 10407.324655264993, 10397.869597269542, 10388.401468965105, 10378.920263852331, 10369.425975530157, 10359.918597695798, 10350.398124144824, 10340.864548771156, 10331.317865567107, 10321.758068623352, 10312.185152129037, 10302.599110371742, 10292.999937737544, 10283.387628711014, 10273.762177875256, 10264.123579911933, 10254.471829601303, 10244.806921822215, 10235.12885155219, 10225.437613867372, 10215.733203942636, 10206.015617051547, 10196.284848566449, 10186.540893958432, 10176.783748797412, 10167.013408752118, 10157.229869590152, 10147.433127178001, 10137.62317748108, 10127.80001656373, 10117.963640589287, 10108.114045820086, 10098.251228617488, 10088.375185441933, 10078.485912852952, 10068.583407509199, 10058.667666168485, 10048.73868568781, 10038.796463023384, 10028.84099523068, 10018.872279464418, 10008.890312978678, 9998.89508890621, 9988.886575899971, 9978.864734009041, 9968.829523616669, 9958.7809054526, 9948.718840593061, 9938.643290460737, 9928.55421682475, 9918.451581800673, 9908.335347850458, 9898.205477782481, 9888.0619347515, 9877.904682258595, 9867.733684151215, 9857.548904623109, 9847.350308214343, 9837.137859811248, 9826.911524646417, 9816.671268298676, 9806.41705669307, 9796.148856100832, 9785.866633139369, 9775.570354772222, 9765.259988309059, 9754.935501405638, 9744.596862063805, 9734.244038631437, 9723.876999802435, 9713.495714616683, 9703.10015246006, 9692.690283064352, 9682.266076507278, 9671.827503212427, 9661.374533949247, 9650.907139833014, 9640.425292324797, 9629.928963231418, 9619.418124705437, 9608.892749245144, 9598.352809694452, 9587.79827924294, 9577.2291314258, 9566.645340123769, 9556.046879563153, 9545.433724315728, 9534.805849298762, 9524.163229774946, 9513.505841352384, 9502.833659984515, 9492.146661970131, 9481.444823953294, 9470.728122923327, 9459.996536214752, 9449.250041507268, 9438.48861682571, 9427.712240540019, 9416.920891365164, 9406.114548361144, 9395.293190932925, 9384.456798830412, 9373.605352140648, 9362.738814338702, 9351.857096472095, 9340.9600999884, 9330.047727050716, 9319.119880537739, 9308.176464043812, 9297.21738187906, 9286.242539069384, 9275.251841356618, 9264.24519519854, 9253.222507768996, 9242.183686957975, 9231.1286413717, 9220.057280332683, 9208.969513879856, 9197.865252768668, 9186.74440847112, 9175.606893175953, 9164.452619788644, 9153.281501931597, 9142.093453944195, 9130.888390882934, 9119.666228521493, 9108.42688335089, 9097.17027257957, 9085.896314133515, 9074.604926656364, 9063.296029509549, 9051.96954277239, 9040.625387242235, 9029.263484434585, 9017.883756583205, 9006.486126640279, 8995.070518276516, 8983.636855881308, 8972.185064562842, 8960.715070148246, 8949.226799183767, 8937.72017893484, 8926.195137386296, 8914.651603242479, 8903.089505927399, 8891.508775584898, 8879.909343078774, 8868.291139992978, 8856.654098631727, 8844.99815201969, 8833.323233902154, 8821.629278745173, 8809.916221735746, 8798.183998781964, 8786.43254651322, 8774.661802280349, 8762.871704155808, 8751.062190933873, 8739.233202058078, 8727.384625067107, 8715.516203421013, 8703.627657813535, 8691.71871115354, 8679.789088564903, 8667.838517386335, 8655.866727171197, 8643.87344968734, 8631.858418916909, 8619.821371056096, 8607.762044514964, 8595.680179917183, 8583.575520099796, 8571.447810112955, 8559.296797219657, 8547.122230895438, 8534.923862828115, 8522.701446917441, 8510.454739274794, 8498.18349822286, 8485.887484295283, 8473.566460236267, 8461.22019100027, 8448.848443751573, 8436.450987863904, 8424.027594920022, 8411.57803871131, 8399.102095237335, 8386.59954270538, 8374.070161530044, 8361.513734332715, 8348.930045941119, 8336.318883388803, 8323.680035914664, 8311.01329496239, 8298.318454179958, 8285.59530941908, 8272.843658734639, 8260.063302384131, 8247.254042827079, 8234.41568472444, 8221.548034938001, 8208.650902529758, 8195.724098761293, 8182.767437093117, 8169.780733184038, 8156.763804890463, 8143.716472265732, 8130.638557559441, 8117.529885216703, 8104.390279281407, 8091.219448594429, 8078.016942255673, 8064.782301327186, 8051.5150708701985, 8038.214799944996, 8024.881041610695, 8011.513352925129, 7998.1112949446415, 7984.674432723975, 7971.202335316058, 7957.6945757719295, 7944.150731140538, 7930.570382468638, 7916.95311480064, 7903.2985171784985, 7889.606182641573, 7875.875708226521, 7862.106694967176, 7848.298747894445, 7834.451476036207, 7820.5644924171975, 7806.637414058949, 7792.669861979666, 7778.661461194151, 7764.611840713732, 7750.520633546189, 7736.387476695677, 7722.212011162654, 7707.993881943835, 7693.732738032134, 7679.428232416608, 7665.080022082403, 7650.687768010741, 7636.25113517884, 7621.76979255993, 7607.24341312319, 7592.671673833747, 7578.054255652647, 7563.3908435368485, 7548.681126439215, 7533.924797308501, 7519.121553089384, 7504.2710947224305, 7489.37312714414, 7474.427357074062, 7459.432910061242, 7444.3875538342945, 7429.288879171995, 7414.134495844729, 7398.922032615861, 7383.64913724324, 7368.313476480901, 7352.912736080918, 7337.444620795503, 7321.906854379204, 7306.297179591331, 7290.613358198557, 7274.853170977691, 7259.014417718627, 7243.094917227477, 7227.092507329885, 7211.00504487452, 7194.830405736764, 7178.566484822522, 7162.2111960723105, 7145.762472465407, 7129.218266024294, 7112.576547819193, 7095.835307972829, 7078.992555665361, 7062.0463191394865, 7044.994645705731, 7027.835601747908, 7010.56727272878, 6993.187763195885, 6975.695196787524, 6958.0877162389625, 6940.363483388804, 6922.520679185521, 6904.557503694175, 6886.472176103335, 6868.262934732167, 6849.928037037679, 6831.465759622153, 6812.874428393595, 6794.152578165146, 6775.29883520312, 6756.3118431290095, 6737.1902627468735, 6717.932772036374, 6698.53806614564, 6679.00485738382, 6659.331875213415, 6639.517866242321, 6619.561594215657, 6599.461840007288, 6579.21740161114, 6558.82709413224, 6538.289749777475, 6517.604217846142, 6496.769364720216, 6475.784073854348, 6454.647245765664, 6433.357798023216, 6411.91466523727, 6390.31679904831, 6368.563168115714, 6346.652758106308, 6324.584571682547, 6302.3576284905075, 6279.970965147576, 6257.423635229939, 6234.71470925978, 6211.843274692207, 6188.808435901963, 6165.609314169864, 6142.245047668961, 6118.713400460026, 6094.995528997528, 6071.061800233069, 6046.882638757908, 6022.428721636985, 5997.670978412096, 5972.580591109937, 5947.128994254802, 5921.2878748861685, 5895.029172580943, 5868.325079480583, 5841.1480403229025, 5813.470752478718, 5785.26616599319, 5756.507483632031, 5727.168160932384, 5697.2219062585655, 5666.642680862495, 5635.404698948964, 5603.4824277456355, 5570.850587577829, 5537.484151948075, 5503.358347620434, 5468.448654709603, 5432.730806774786, 5396.1807909183035, 5358.774847889043, 5320.494144455441, 5281.3510560986115, 5241.370523571145, 5200.577364540812, 5158.996235988435, 5116.651634068711, 5073.567893976158, 5029.769189815951, 4985.279534479874, 4940.12277952719, 4894.322615070604, 4847.902569667202, 4800.886010214396, 4753.296141850876, 4705.156007862613, 4656.488489593831, 4607.316306363033, 4557.662015383953, 4507.548011691656, 4456.996528073528, 4406.003013747047, 4354.074719521878, 4300.29576336354, 4243.744040547118, 4183.505837671011, 4118.675834488639, 4048.3571067232424, 3971.661129865632, 3887.7077839550343, 3795.625359342898, 3694.5505634398596, 3583.6285284456017, 3462.012820061857, 3328.8654471883124, 3183.3568726017434, 3024.666024617987, 2851.9803097371005, 2664.4956262713495, 2461.416378956535, 2241.955494546076, 2005.3344383882968]
Mdistr = [0, -12682.431050626581, -12682.248467378024, -12681.700727928437, -12680.787863165602, -12679.509924567596, -12677.866984200422, -12675.85913471476, -12673.486489341667, -12670.74918188746, -12667.647366727597, -12664.181218799626, -12660.35093359514, -12656.156727150943, -12651.598836039073, -12646.677517356069, -12641.39304871117, -12635.74572821366, -12629.735874459182, -12623.363826515202, -12616.629943905502, -12609.534606593688, -12602.078214965817, -12594.261189812081, -12586.083972307484, -12577.547023991663, -12568.650826747722, -12559.395882780133, -12549.782714591705, -12539.81186495959, -12529.483896910402, -12518.799393694295, -12507.758958758252, -12496.363215718271, -12484.612808330727, -12472.508400462726, -12460.050676061575, -12447.240339123291, -12434.078113660089, -12420.564743667097, -12406.700993087978, -12392.48764577967, -12377.925505476225, -12363.015726389407, -12347.763098636085, -12332.17464875141, -12316.257434127945, -12300.01850891363, -12283.46492286417, -12266.603720218067, -12249.441938594822, -12231.986607915938, -12214.244749349036, -12196.223374274903, -12177.929483277592, -12159.37006515768, -12140.552095968436, -12121.48253807515, -12102.168339237507, -12082.616431714989, -12062.833731395403, -12042.827136946384, -12022.6035289899, -12002.169769299875, -11981.532700022659, -11960.699142920495, -11939.675898637935, -11918.469745991091, -11897.087441279737, -11875.535717622228, -11853.821284313137, -11831.950826203592, -11809.931003104328, -11787.768449211266, -11765.469772553615, -11743.04155446451, -11720.490349074047, -11697.822682824599, -11675.045054008468, -11652.163932327752, -11629.185758476247, -11606.116943743562, -11582.963869641, -11559.732887549571, -11536.430318389586, -11513.062452312151, -11489.635548412225, -11466.155834463269, -11442.629506673286, -11419.06272946237, -11395.461635261416, -11371.832324332097, -11348.180864607859, -11324.513291556053, -11300.835608060845, -11277.153784326962, -11253.47375780423, -11229.801433132612, -11206.142682107848, -11182.503343667498, -11158.889223897202, -11135.30609605731, -11111.759700629513, -11088.255745383573, -11064.799905463862, -11041.397823495805, -11018.05510971201, -10994.777342098014, -10971.57006655756, -10948.438797097202, -10925.389016030398, -10902.426174200658, -10879.555691223943, -10856.78295574997, -10834.113325742584, -10811.552128778883, -10789.104662367086, -10766.776194283153, -10744.57196292587, -10722.497177690419, -10700.55701936047, -10678.7566405184, -10657.101165973869, -10635.595693210462, -10614.245292850495, -10593.054958896268, -10572.026822293066, -10551.158708287632, -10530.448096974986, -10509.89248300719, -10489.489375411707, -10469.236297412846, -10449.130786256164, -10429.170393035765, -10409.352682524683, -10389.67523300811, -10370.135636119592, -10350.731496680108, -10331.460432540014, -10312.32007442396, -10293.30806577857, -10274.42206262299, -10255.659733402279, -10237.018758843615, -10218.496831815302, -10200.091657188548, -10181.800951702036, -10163.622443829207, -10145.553873648369, -10127.592992715458, -10109.737563939541, -10091.98536146102, -10074.3341705326, -10056.781787402748, -10039.326019202059, -10021.964683832039, -10004.695609856744, -9987.516636396853, -9970.425613026473, -9953.420399672552, -9936.498866516817, -9919.658893900294, -9902.898372230451, -9886.215201890913, -9869.607293153596, -9853.072566093504, -9836.608950506006, -9820.214385826568, -9803.886821053107, -9787.624214670694, -9771.424534578855, -9755.285758021262, -9739.205871517896, -9723.182870799708, -9707.214760745645, -9691.299555322126, -9675.43527752501, -9659.619959323802, -9643.851641608433, -9628.128374138316, -9612.448215493814, -9596.809233030064, -9581.209502833188, -9565.647109678797, -9550.120146992873, -9534.626716814983, -9519.16492976373, -9503.732905004686, -9488.328770220409, -9472.950661582905, -9457.596723728282, -9442.265109733786, -9426.953981096916, -9411.661507716983, -9396.385867878773, -9381.125248238504, -9365.87784381201, -9350.641857965107, -9335.415502406191, -9320.196997180996, -9304.9845706696, -9289.776459585513, -9274.57090897704, -9259.366172230735, -9244.160511076972, -9228.95219559774, -9213.739504236542, -9198.520937380224, -9183.296384361172, -9168.066285184832, -9152.831079647392, -9137.591205908762, -9122.347100489062, -9107.09919826528, -9091.847932468052, -9076.593734678554, -9061.33703482552, -9046.078261182338, -9030.817840364381, -9015.556197326314, -9000.293755359622, -8985.030936090232, -8969.76815947622, -8954.505843805706, -8939.244405694768, -8923.984260085606, -8908.72582024468, -8893.46949776108, -8878.21570254496, -8862.96484282606, -8847.717325152462, -8832.473554389273, -8817.233933717622, -8801.998864633628, -8786.76874694755, -8771.543978783042, -8756.3249565765, -8741.112075076562, -8725.905727343661, -8710.706304749738, -8695.514196978087, -8680.329792023233, -8665.15347619098, -8649.98563409859, -8634.826648674993, -8619.676901161161, -8604.53677111062, -8589.40663639, -8574.286873179724, -8559.177855974856, -8544.079957585953, -8528.993549140103, -8513.919000082076, -8498.85667817552, -8483.806949504304, -8468.770178473986, -8453.74672781332, -8438.736958575942, -8423.741230142123, -8408.759900220606, -8393.793324850601, -8378.841858403855, -8363.90585358678, -8348.985661442788, -8334.081631354615, -8319.194111046825, -8304.323446588396, -8289.469982395385, -8274.63406123369, -8259.816024221982, -8245.016210834641, -8230.234958904824, -8215.472604627717, -8200.729482563713, -8186.005925641853, -8171.302265163282, -8156.618830804789, -8141.955950622531, -8127.3139510557185, -8112.6931569305525, -8098.093891464099, -8083.5164762684035, -8068.961231354592, -8054.428475137122, -8039.918524438117, -8025.431694491769, -8010.968298948888, -7996.52861622097, -7982.112622411214, -7967.720135349886, -7953.350972261455, -7939.004951186449, -7924.68189097926, -7910.381611305989, -7896.103932642176, -7881.848676270741, -7867.61566427978, -7853.404719560481, -7839.215665805004, -7825.048327504423, -7810.902529946634, -7796.778099214359, -7782.674862183083, -7768.592646519076, -7754.531280677428, -7740.49059390004, -7726.470416213713, -7712.470578428217, -7698.490912134398, -7684.531249702246, -7670.5914242790905, -7656.671269787699, -7642.770620924475, -7628.889313157623, -7615.0271827253955, -7601.184066634261, -7587.3598026571935, -7573.554229331893, -7559.7671859591255, -7545.998512600957, -7532.248050079094, -7518.5156399732205, -7504.8011246193455, -7491.1043471081775, -7477.4251512834935, -7463.763381740572, -7450.118883824572, -7436.491503629022, -7422.88108799423, -7409.287484505804, -7395.7105414930875, -7382.150108027722, -7368.606033922141, -7355.078169728121, -7341.566366735331, -7328.070476969927, -7314.590353193131, -7301.125848899839, -7287.676818317271, -7274.24311640355, -7260.824598846459, -7247.421122062036, -7234.032543193291, -7220.658720108923, -7207.29951140204, -7193.954776388894, -7180.624375107638, -7167.308168317096, -7154.006017495574, -7140.717784839623, -7127.443333262897, -7114.182526394963, -7100.9352285801715, -7087.701304876504, -7074.480621054474, -7061.273043595994, -7048.078439693342, -7034.89667724802, -7021.7276248697535, -7008.571151875419, -6995.427128288027, -6982.29542483571, -6969.1759129507245, -6956.068464768461, -6942.972953126495, -6929.889256696113, -6916.817334107725, -6903.7572065498925, -6890.708896816061, -6877.672427615242, -6864.6478215720235, -6851.635101226587, -6838.634289034733, -6825.645407367902, -6812.66847851318, -6799.703524673321, -6786.750567966789, -6773.809630427747, -6760.880734006081, -6747.9639005674535, -6735.059151893282, -6722.166509680789, -6709.285995543007, -6696.417631008809, -6683.561437522929, -6670.717436445982, -6657.885649054491, -6645.066096540904, -6632.2588000136275, -6619.463780497042, -6606.681058931514, -6593.910656173449, -6581.152592995302, -6568.406890085593, -6555.673568048951, -6542.952647406111, -6530.244148593989, -6517.5480919656475, -6504.864497790369, -6492.193386253659, -6479.534777457287, -6466.888691419302, -6454.255148074068, -6441.634167272286, -6429.025768781025, -6416.429972283768, -6403.846797380394, -6391.276263587276, -6378.718390337238, -6366.173196979643, -6353.640702780385, -6341.120926921949, -6328.613888503406, -6316.119606540491, -6303.638099965592, -6291.1693876278, -6278.713488292952, -6266.270420643632, -6253.840203279238, -6241.422854715993, -6229.018393386988, -6216.626837642211, -6204.24820574859, -6191.882515889999, -6179.529786167348, -6167.190034598544, -6154.863279118591, -6142.549537579602, -6130.24882775081, -6117.961167318646, -6105.686573886747, -6093.425064976004, -6081.176658024602, -6068.941370388037, -6056.719219339185, -6044.510222068308, -6032.314395683116, -6020.131757208791, -6007.962323588034, -5995.8061116810995, -5983.663138265844, -5971.533414881022, -5959.4169271914925, -5947.313652873769, -5935.223569716768, -5923.146655624345, -5911.082888615115, -5899.032246822228, -5886.994708493193, -5874.970251989662, -5862.958855787268, -5850.960498475387, -5838.975158756974, -5827.002815448354, -5815.043447479024, -5803.097033891469, -5791.1635538409655, -5779.242986595388, -5767.335311535008, -5755.440508152309, -5743.558556051794, -5731.689434949795, -5719.833124674279, -5707.989605164648, -5696.158856471575, -5684.34085875678, -5672.535592292862, -5660.743037463102, -5648.963174761283, -5637.1959847914895, -5625.441448267914, -5613.6995460146945, -5601.970258965702, -5590.253568164364, -5578.549454763481, -5566.857900025025, -5555.178885319964, -5543.512392128096, -5531.858402037812, -5520.216896745963, -5508.587858057652, -5496.971267886049, -5485.367108252208, -5473.775361284895, -5462.196009220381, -5450.629034402289, -5439.074419281376, -5427.532146415406, -5416.002198468892, -5404.484558212981, -5392.979208525239, -5381.486132389482, -5370.005312895586, -5358.536733239324, -5347.080376722158, -5335.6362267510885, -5324.204266838463, -5312.784480601798, -5301.376851763589, -5289.981364151156, -5278.598001696453, -5267.226748435875, -5255.867588510119, -5244.5205061639535, -5233.185485746106, -5221.8625117090305, -5210.551568608762, -5199.252641104731, -5187.96571395959, -5176.6907720390445, -5165.427800311668, -5154.176783848721, -5142.9377078239995, -5131.710557558405, -5120.4953238829385, -5109.292008193514, -5098.100613111554, -5086.921141274047, -5075.753595333451, -5064.597977957554, -5053.454291829362, -5042.322539646955, -5031.2027241233955, -5020.094847986604, -5008.998913979198, -4997.914924858418, -4986.842883395969, -4975.7827923779305, -4964.734654604602, -4953.698472890406, -4942.674250063747, -4931.661988966897, -4920.661692455879, -4909.673363400326, -4898.697004683385, -4887.732619201554, -4876.7802098646125, -4865.839779595444, -4854.9113313299595, -4843.99486801693, -4833.090392617905, -4822.197908107055, -4811.317417471082, -4800.448923709051, -4789.592429832317, -4778.747938864357, -4767.91545384067, -4757.094977808664, -4746.286513827505, -4735.490064967999, -4724.705634312487, -4713.933224954705, -4703.172839999661, -4692.424482563515, -4681.688155773449, -4670.963862767549, -4660.251606694686, -4649.551390714376, -4638.863217996659, -4628.187091721998, -4617.523015081113, -4606.870991274903, -4596.2310235142795, -4585.603115020063, -4574.987269022868, -4564.383488762956, -4553.791777490122, -4543.212138463572, -4532.6445749517925, -4522.0890902324245, -4511.5456875921545, -4501.014370326559, -4490.495141740014, -4479.988005145549, -4469.492963864723, -4459.010021227507, -4448.53918057215, -4438.080445245069, -4427.633818600704, -4417.199304001412, -4406.776904817326, -4396.366624426234, -4385.968466212272, -4375.5824309513255, -4365.208511291951, -4354.846698369934, -4344.496983400258, -4334.159357676895, -4323.83381257263, -4313.520339538827, -4303.218930105268, -4292.929575879907, -4282.652268548715, -4272.386999875465, -4262.133761701516, -4251.892545945638, -4241.663344603804, -4231.446149748986, -4221.240953530969, -4211.04774817614, -4200.866525987293, -4190.697279343435, -4180.5400006996, -4170.394682586605, -4160.261317610914, -4150.139898454403, -4140.030417874155, -4129.932868702296, -4119.84724384577, -4109.77353628615, -4099.7117390794565, -4089.661845355918, -4079.623848319825, -4069.5977412493044, -4059.583517496132, -4049.581170485516, -4039.5906937159375, -4029.612080758921, -4019.6453252588612, -4009.690420932805, -3999.747361570276, -3989.8161410330645, -3979.8967532550405, -3969.9891922419492, -3960.0934520712294, -3950.209526891797, -3940.337410923875, -3930.477098458768, -3920.6285838587037, -3910.7918615565986, -3900.9669260558985, -3891.153771930352, -3881.352393823839, -3871.5627864501657, -3861.784944592876, -3852.018863105046, -3842.2645369090974, -3832.5219609966034, -3822.79113042809, -3813.072040332849, -3803.3646859087326, -3793.66906242197, -3783.9851652069683, -3774.3129896661167, -3764.6525312695976, -3755.0037855551927, -3745.3667481280722, -3735.7414146606384, -3726.1277800696826, -3716.5258345646407, -3706.9355667775685, -3697.356965511592, -3687.790019742682, -3678.2347186189827, -3668.6910514601595, -3659.1590077567603, -3649.638577169545, -3640.129749528834, -3630.6325148338647, -3621.1468632521355, -3611.6727851187256, -3602.2102709356755, -3592.759311371299, -3583.3198972595633, -3573.892019599393, -3564.4756695540427, -3555.0708384504305, -3545.6775177784816, -3536.295699190471, -3526.9253745003693, -3517.5665356831796, -3508.219174874285, -3498.883284368783, -3489.558856620848, -3480.245884243041, -3470.944360005683, -3461.6542768361664, -3452.3756278183287, -3443.108406191763, -3433.8526053511764, -3424.608218845726, -3415.3752403783537, -3406.15366380514, -3396.9434831346316, -3387.7446925271797, -3378.5572862942886, -3369.381258897957, -3360.216604950002, -3351.063319211404, -3341.9213965916683, -3332.79083214812, -3323.6716210852896, -3314.563758754203, -3305.467240651764, -3296.382062420066, -3287.3082198457405, -3278.2457088592823, -3269.194525534407, -3260.1546660873705, -3251.1261268763174, -3242.1089044006058, -3233.102995300154, -3224.108396354781, -3215.125104483533, -3206.1531167440216, -3197.1924303317655, -3188.2430425795233, -3179.3049509566313, -3170.37815306712, -3161.4626439940403, -3152.5584107032305, -3143.6654387734684, -3134.783714014072, -3125.9132224640794, -3117.0539503914238, -3108.205884292141, -3099.369010889538, -3090.543317133388, -3081.7287901991062, -3072.925417486947, -3064.1331866211935, -3055.3520854493386, -3046.5821020412654, -3037.8232246884595, -3029.075441903187, -3020.3387424176685, -3011.613115183305, -3002.898549369829, -2994.19503436453, -2985.5025597714225, -2976.8211154104574, -2968.150691316693, -2959.4912777395116, -2950.8428651417967, -2942.205444199135, -2933.5790057990016, -2924.963541039971, -2916.3590412308945, -2907.76549789011, -2899.1829027446283, -2890.6112477293345, -2882.050524986184, -2873.5007268633985, -2864.961845914664, -2856.4338748983264, -2847.9168067765922, -2839.410634714736, -2830.9153520802715, -2822.4309524421847, -2813.9574295701086, -2805.494777433532, -2797.0429902010055, -2788.6020622393244, -2780.17198811275, -2771.7527625821954, -2763.3443806044297, -2754.9468373312848, -2746.560128108852, -2738.1842484766835, -2729.819194166994, -2721.4649611038717, -2713.1215454024655, -2704.7889433682017, -2696.467151495977, -2688.1561664393553, -2679.8559633504333, -2671.566458118229, -2663.2875576732577, -2655.0191703097335, -2646.761205679928, -2638.5135747885292, -2630.276189987, -2622.048964967918, -2613.8318147593077, -2605.624655718962, -2597.427405528783, -2589.239983189069, -2581.0623090128342, -2572.8943046201007, -2564.73589293219, -2556.5869981660003, -2548.4475458282914, -2540.3174627099447, -2532.196676880224, -2524.0851176810434, -2515.982715721199, -2507.889402870608, -2499.8051122545644, -2491.7297782479473, -2483.6633364694476, -2475.6057237757823, -2467.5568782559085, -2459.516739225223, -2451.48524721975, -2443.4623439903494, -2435.447972496887, -2427.442076902421, -2419.4446025673647, -2411.4554960436712, -2403.474705068978, -2395.5021785607764, -2387.537866610554, -2379.5817204779455, -2371.6336925848723, -2363.6937365096733, -2355.7618069812434, -2347.837859873151, -2339.9218521977655, -2332.013742100373, -2324.113488853276, -2316.2210528499227, -2308.3363955989853, -2300.459479718468, -2292.590268929808, -2284.7287280519463, -2276.8748236161114, -2269.0285512475452, -2261.1899459952933, -2253.3590458933995, -2245.535889076154, -2237.720513776813, -2229.912958326289, -2222.1132611518688, -2214.3214607759105, -2206.537595814555, -2198.761704976417, -2190.9938270613115, -2183.23400095894, -2175.4822656476076, -2167.7386601929197, -2160.003223746495, -2152.2759955446677, -2144.5570149071905, -2136.8463212359406, -2129.1439540136307, -2121.449952802507, -2113.764357243054, -2106.087207052712, -2098.4185420245694, -2090.7584020260706, -2083.106826997725, -2075.4638569518115, -2067.8295319710833, -2060.2038922074685, -2052.5869778807846, -2044.9788292774354, -2037.3794867491217, -2029.7889907115423, -2022.2073816431025, -2014.634700083613, -2007.0709866330053, -1999.5162819500272, -1991.970626750948, -1984.434061808274, -1976.906627949438, -1969.3883660555157, -1961.8793170599195, -1954.3795219471158, -1946.8890217513183, -1939.4078575551994, -1931.9360693335545, -1924.4733922195107, -1917.0188552301595, -1909.5714006226951, -1902.129986276385, -1894.6935856226144, -1887.2611875750652, -1879.8317964600449, -1872.4044319469563, -1864.978128978926, -1857.5519377035564, -1850.1249234038246, -1842.696166429118, -1835.2647621264098, -1827.8298207715634, -1820.3904675007664, -1812.9458422421026, -1805.495099647246, -1798.037409023292, -1790.5719542646866, -1783.0979337853162, -1775.6145604506864, -1768.121061510238, -1760.6166785297705, -1753.1006673239867, -1745.572297889151, -1738.0308543358544, -1730.4756348218932, -1722.905951485252, -1715.3211303772002, -1707.720511395487, -1700.1034482176328, -1692.4693082343344, -1684.8174724829646, -1677.1473355811602, -1669.4583056605102, -1661.749804300344, -1654.0212664616017, -1646.272140420797, -1638.50188770406, -1630.710235355843, -1622.8985059777442, -1615.0686222156687, -1607.2224841961533, -1599.3619682311903, -1591.4889269154037, -1583.6051892236403, -1575.7125606089517, -1567.8128231009753, -1559.907735404695, -1551.9990329995971, -1544.0884282391937, -1536.1776104509368, -1528.2682460364927, -1520.3619785723838, -1512.4604289110032, -1504.5651952819755, -1496.6778533938793, -1488.7999565363236, -1480.9330356823516, -1473.0785995912076, -1465.2381349114376, -1457.4131062842964, -1449.6049564475263, -1441.8151063394175, -1434.044955203226, -1426.2958806918664, -1418.5692389729575, -1410.8663648341487, -1403.1885717887478, -1395.5371521816621, -1387.9133772956254, -1380.3184974577055, -1372.7529799322792, -1365.2081860980131, -1357.6696385415507, -1350.1229887109432, -1342.5541226818068, -1334.9491599500843, -1327.2944522294333, -1319.5765822530902, -1311.782362580231, -1303.8988344066902, -1295.9132663800458, -1287.8131534189363, -1279.5862155366176, -1271.2203966686216, -1262.7038635045355, -1254.025004323756, -1245.1724278352253, -1236.1349620210326, -1226.9016529838575, -1217.461763798162, -1207.804773365089, -1197.9203752709925, -1187.7984766495351, -1177.429197047303, -1166.8028672928622, -1155.9100283691853, -1144.7414302894147, -1133.2945054461104, -1121.6096416232342, -1109.743999906265, -1097.75386171182, -1085.6945815158967, -1073.6205916295305, -1061.5854070046303, -1049.6416300695087, -1037.8409555937192, -1026.2341755817338, -1014.871184195069, -1003.8009827023961, -993.0716844572187, -982.7305199026796, -972.8238416030911, -963.3971293017165, -954.4949950044124, -946.1611880886638, -938.4386004376249, -931.369271598693, -924.9820498464226, -919.079254830735, -913.2692337787846, -907.160574992208, -900.3688595137633, -892.5166225124411, -883.2333154758528, -872.1552691970203, -858.9256575427144, -843.1944619904478, -824.6184369212723, -802.8610756554478, -777.5925772181222, -748.489813822065, -715.2362990545859, -677.5221567556252, -635.0440905741135, -587.5053541895433, -534.6157221858718, -476.0914615645803, -411.6553038839507]

Ldistr = np.array(Ldistr) * n
Ldistr = Ldistr.tolist()


# Calculation accuracy
points = len(Ldistr) + 1    # Calculation accuracy  [-]
step = (b/2)/points         # Step size             [-]

# Moment distribution function --------------------------------------------------------------

def getMomentDistr(Ldistr):
    Ldistr[0] = 0
    Ldistr.append(0)
    LdistrArr = -1 * np.array(Ldistr)
    Ldistr = list(LdistrArr)

    # Input variables
    L = b/2  # half wing span
    Lmax = 2500
    npoints = len(Ldistr) - 1
    dy = L / npoints

    # Find p position
    Ppos = round(0.35 * npoints)

    def p(n, Ppos):
        if n == Ppos:
            return 20267
        else:
            return 0


    # Calculate wing weight along y
    def W_w(y):
        return 391.2366 * (-0.215585 * y + 3.695654)

    W_w_distr = []
    for n in range(npoints + 1):
        W_w_distr.append(W_w((L / npoints) * n))
    W_w_distr[0] = 0
    W_w_distr[npoints] = 0

    halfWingWeight, error = sp.integrate.quad(W_w, 0, L)
    #print(halfWingWeight)
    
    # Calculate shear
    sumdistr = []
    for n in range(npoints + 1):
        sumdistr.append((W_w_distr[n] + Ldistr[n]))

    shear_internal_distr = []
    for n in range(npoints + 1):
        sum_integral = []
        for n_1 in range(n, npoints + 1):
            sum_integral.append((sumdistr[n_1] * dy + p(n_1, Ppos)))
        sum_contribution = sum(sum_integral)
        shear_internal_distr.append(sum_contribution)

    moment_internal_distr = []
    for n in range(npoints + 1):
        sum_integral = []
        for n_1 in range(n, npoints + 1):
            sum_integral.append((shear_internal_distr[n_1] * dy))
        sum_contribution = sum(sum_integral)
        moment_internal_distr.append(sum_contribution)

    # Make graphs
    ytab = []
    for n in range(npoints + 1):
        ytab.append(n)

    return moment_internal_distr

# Torque distribution function ----------------------------------------------------------------------------------------------

def getTorsionDistribution(Ldistr, M_distr, rho, V, T):
    # Define inputs
    def c(y):
        c = -0.21558573 * y + 3.6956254
        return c

    b_half = 12.009

    W_e = (2066 + (872.57 / 2)) * 9.81
    z_e = 0.7149
    x_e = 0.4661 + 0.15 * c(0.35 * b_half)
    y_e_ratio = 0.35

    # Along span
    npoints = len(Ldistr)
    y_e_point = round(npoints * y_e_ratio)

    c_distr = []
    for n in range(npoints):
        c_distr.append(c((b_half / npoints) * n))

    # Starting at wingtip
    torsion_distr = []
    for n in range(npoints):
        if abs(n - y_e_point) < 0.020833 * npoints:
            torsion_distr.append(
                (T * z_e - W_e * x_e) / (0.020833 * 2 * b_half) + Ldistr[n] * 0.15 * c_distr[n] + M_distr[n])
        else:
            torsion_distr.append(Ldistr[n] * 0.15 * c_distr[n] + M_distr[n])

    torsion_distr_new = []
    for n in range(npoints):
        if n > y_e_point:
            total_torsion = Ldistr[n] * 0.15 * c_distr[n] + M_distr[n]
            torsion_distr_new.append(total_torsion)
        else:
            total_torsion = Ldistr[n] * 0.15 * c_distr[n] + M_distr[n]
            torsion_distr_new.append(total_torsion)

    # Integrating
    dy = b_half / npoints

    torsion_int_distr = []

    def engine(n, T, z_e, W_e, x_e, y_e_point, npoints, b_half):
        if abs(n - y_e_point) < 0.020833 * npoints:
            return (T * z_e - W_e * x_e) / (0.020833 * 2 * b_half)
        else:
            return 0

    for n in range(npoints):
        sum_integral = []
        for n_1 in range(n, npoints):
            sum_integral.append(
                torsion_distr[n_1] * dy + engine(n_1, T, z_e, W_e, x_e, y_e_point, npoints, b_half) * dy)

        summation = sum(sum_integral)
        torsion_int_distr.append(summation)

    # Make graphs
    ytab = []
    for n in range(npoints):
        ytab.append(n)

    return torsion_int_distr

# Calculations of length, area & centroid ---------------------------------------------------

# Creating the steps and interval. This will decide the level
#   of detail of the calculations
y = np.linspace(0, b/2, points)
n_points = len(y)
C_y = C_r + C_t * (y/(b/2)) - C_r * (y/(b/2))   # Chord as function of y    [m]
ylst = y.tolist()

# Calculating the neutral axis, dividing the wing box plates into 4 parts
# Part length       [m]
L_I = (x_rearspar - x_frontspar) * C_y 
L_II = h_rearspar * C_y
L_IV = h_frontspar * C_y
L_III = np.sqrt( (L_IV-L_II)**2 + L_I**2)

# Part area         [m^2]
A_I = L_I * t_sheet_hor
A_II = L_II * t_sheet_spar
A_III = L_III * t_sheet_hor
A_IV = L_IV * t_sheet_spar

# Part centroid     [m]
z_I = L_IV
z_II = L_IV - 0.5*L_II
z_III = 0.5 * (L_IV - L_II)
z_IV = 0.5 * L_IV

# Calculating the wing box mass -------------------------------------------------------------

# Individual sheets
M_I = (L_I[0] + L_I[-1]) / 2 * t_sheet_hor * b/2 * rho
M_II = (L_II[0] + L_II[-1]) / 2 * t_sheet_spar * b/2 * rho
M_III = (L_III[0] + L_III[-1]) / 2 * t_sheet_hor * b/2 * rho
M_IV = (L_IV[0] + L_IV[-1]) / 2 * t_sheet_spar * b/2 * rho

# Stringers
lentot_top = 0
for i in range(len(distance_top)):
    lentot_top += len(topstr(distance_top[i])) * distance_top[i] * b/2

lentot_bot = 0
for i in range(len(distance_bot)):
    lentot_bot += len(botstr(distance_bot[i])) * distance_bot[i] * b/2

lentot = lentot_top + lentot_bot

M_str = lentot * A_str * rho

# Total mass
Mass = M_I + M_II + M_III + M_IV + M_str


# Calculating the moment of inertia for the stringers----------------------------------------

n_iterations = len(y)

# Top stringers
y_n = 0
n_strlist_top = []

# This loop computes the # of stringers at each y coord
for i in range(n_iterations):
    n_str_y_n = len(topstr(y_n/(b/2))[topstr(y_n/(b/2)) != 0])
    y_n += step
    n_strlist_top.append(n_str_y_n)

n_str_top = np.array(n_strlist_top)

# Bottom stringers
y_n = 0
n_strlist_bot = []

# This loop computes the # of stringers at each y coord
for i in range(n_iterations):
    n_str_y_n = len(botstr(y_n/(b/2))[botstr(y_n/(b/2)) != 0])
    y_n += step
    n_strlist_bot.append(n_str_y_n)

n_str_bot = np.array(n_strlist_bot)

# z-coordinate of neutral axis, as seen from the bottom of the front spar
z_n = (A_str*(n_str_top)*z_I + A_str*(n_str_bot)*z_III + A_I*z_I + A_II*z_II + A_III*z_III + A_IV*z_IV) / (A_I + A_II + A_III + A_IV + A_str*(n_str_top+n_str_bot))

# Stringer MOI
I_str_bot = n_str_bot * A_str * (z_I-z_n)**2
I_str_top = n_str_top * A_str * (z_I-z_n)**2

# Calculating the moment of inertia for the sheets-------------------------------------------


# Parts 1, 2 and 4
I_I = L_I * t_sheet_hor**3 * (1/12) + A_I * (z_I-z_n)**2
I_II = t_sheet_spar * L_II**3 * (1/12) + A_II * (z_II-z_n)**2
I_IV = t_sheet_spar * L_IV**3 * (1/12) + A_IV * (z_IV-z_n)**2

# Part 3 is slanted
I_III_x = L_III * t_sheet_hor**3 * (1/12)
I_III_y = t_sheet_hor * L_III**3 * (1/12)
theta_III = np.tan((L_IV-L_II)/L_I)

I_III = I_III_x * np.cos(theta_III)**2 + I_III_y * np.sin(theta_III)**2 + A_III * (z_III-z_n)**2

# Final MOI         [m^4]
I = I_I + I_II + I_III + I_IV + I_str_top + I_str_bot
I_lst = np.array(I).tolist()
AMOI = sp.interpolate.interp1d(y,I_lst,kind='cubic',fill_value='extrapolate')
I_plot = np.array(AMOI(y))

def I_y(y):
    return AMOI(y)

# OUTPUT: Moment of inertia as a function of y: I_y(y) 
print('MOI done')

# Calculating the torsional constant --------------------------------------------------------


A_encl = L_I*L_II + (L_IV-L_II)*L_I*0.5 - A_str*(n_str_bot+n_str_top) # Enclosed area [m^2]
ds_t = (L_I+L_III) / t_sheet_hor + (L_II+L_IV) / t_sheet_spar         # Integral of the reciprocal of t and length

J = 4 * A_encl**2 / ds_t                        # Torsional constant
T_C = sp.interpolate.interp1d(y,J,kind='cubic',fill_value='extrapolate')
J_plot = np.array(T_C(y))

def J_y(y):
    return T_C(y)

# OUTPUT: Torsional constant as a function of y: J_y(y)
print('J done')

# This section will be deleted once the moment and torque function is available -------------
M = getMomentDistr(Ldistr)
T = getTorsionDistribution(Ldistr, Mdistr, rho, V, T_engine)

# Calculating deflection --------------------------------------------------------------------


# Retrieving -M/EI
MEI = M/(E*I)

# First integration
MEIfunc = sp.interpolate.interp1d(y,MEI,kind='cubic',fill_value='extrapolate')
dvdylst = []

for i in range(n_iterations):
    dvdy = sp.integrate.quad(MEIfunc, ylst[i], (b/2))
    dvdylst.append(dvdy[0])

dvdy = np.array(dvdylst)

# Adding integration constant (because dvdy(0) = 0)
C_1 = -dvdy[0]
dvdy += C_1

print('First integration done')
# Second integration
dvdyfunc = sp.interpolate.interp1d(y,dvdy,kind='cubic',fill_value='extrapolate')
vlst = []

for i in range(n_iterations):
    v = sp.integrate.quad(dvdyfunc, ylst[i], (b/2))
    vlst.append(v[0])

v = np.array(vlst)

# Adding integration constant (because v(0) = 0)
C_2 = -v[0]
v += C_2
print('Second integration done')

# Calculating twist -------------------------------------------------------------------------


# Retrieving T/GJ
TGJ = T/(G*J)

# Integration
TGJfunc = sp.interpolate.interp1d(y,TGJ,kind='cubic',fill_value='extrapolate')
philst = []

for i in range(n_iterations):
    phi = sp.integrate.quad(TGJfunc, ylst[i], (b/2))
    philst.append(phi[0])

phi = np.array(philst)

# Adding integration constant (phi(0) = 0)

C_3 = -phi[0]
phi += C_3
print('Twist integration done')

# Statistics --------------------------------------------------------------------------------
v_max = -np.amin(v)
v_percentage = v_max/b * 100
phi_max = abs(-np.amax(phi) * 180 / math.pi)

print(' ')
print('The wing box mass (half span) is', round(Mass, 2),'[kg]')
print('The maximum deflection is', round(v_max, 4), '[m] or', round(v_percentage, 3), '[%] of the span.')
print('The maximum twist is', round(phi_max, 4),'[deg]')
print("Calculations took %s seconds." % round((time.time() - start_time), 2))
plt.plot(y, v)
plt.plot(y, dvdy)
plt.plot(y, I)
plt.plot(y, phi)
#plt.plot(y, M)
plt.show()
