''' This script calculates the deflection and twist of a wing box cross section'''
# Keeping time and imports ------------------------------------------------------------------
import time
start_time = time.time()

import math
import numpy as np
import matplotlib.pyplot as plt
import scipy as sp
from scipy import interpolate
from scipy import integrate

# Inputs ------------------------------------------------------------------------------------

# Given by the previous iterations
C_r = 3.695625413           # Root chord            [m]
C_t = 1.107118055           # Tip chord             [m]
b = 24.01371734             # Wing span             [m]
x_frontspar = 0.20          # Front spar position   [%]
x_rearspar = 0.60           # Rear spar position    [%]

# To be exactly determined
t_sheet = 0.005             # Sheet thickness       [m]
points = 1001               # Calculation accuracy  [-]
A_str = 0.001               # Area of a stringer    [m^2]
step = (b/2)/points         # Step size             [-]

# Stringers
''' To insert stringers on your desired location, you first set the intervals at which
the stringers will vary, using distance_top. Then in the stringers_top array you input
the stringer location as % of the chord. With a spacing of [0.25, 0.5, 1] for example,
and locations [[0.2, 0.2, 0.2], [0.4, 0.4, 0], [0.6, 0, 0], [0.8, 0.8, 0.8]], there
will be 4 stringers located at [0.2, 0.4, 0.6, 0.8] percent of the chord up until 25%
of the span. Then until 50% it will look like [0.2, 0.4, 0.8] etc.'''

distance_top = np.array([0.25, 0.5, 1])             # Interval of stringer variance [%span]
stringers_top = np.array([[0.2, 0.2, 0.2], [0.4, 0.4, 0], [0.6, 0, 0], [0.8, 0.8, 0.8]])
topstr = sp.interpolate.interp1d(distance_top,stringers_top,kind='next',fill_value='extrapolate')

distance_bot = np.array([0.25, 0.5, 1])             # Interval of stringer variance [%span]
stringers_bot = np.array([[0.2, 0.2, 0.2], [0.4, 0.4, 0], [0.6, 0, 0], [0.8, 0.8, 0.8]])
botstr = sp.interpolate.interp1d(distance_bot,stringers_bot,kind='next',fill_value='extrapolate')

# Calculated
h_frontspar = 0.0908        # Front spar height     [%]     FILLER
h_rearspar = 0.0804         # Rear spar height      [%]     FILLER

M = np.array(0)             # Array of the moments  [Nm]    FILLER
E = 69 * 10**9              # E-modulus of material [Pa]    FILLER
G = 27 * 10**9              # G-modulus of material [Pa]    FILLER

# Lift distribution -------------------------------------------------------------------------

Ldistr = [12788.369448270327, 12788.400682920008, 12788.494380185548, 12788.650520016414, 12788.869068995093, 12789.149980337026, 12789.49319389067, 12789.898636137454, 12790.366220191787, 12790.895845801084, 12791.48739934574, 12792.140753839125, 12792.855768927628, 12793.632290890586, 12794.470152640355, 12795.369173722254, 12796.329160314624, 12797.349905228757, 12798.43118790894, 12799.572774432472, 12800.774417509614, 12802.035856483619, 12803.35681733074, 12804.737012660204, 12806.176141714226, 12807.673890368023, 12809.229931129777, 12810.843923140685, 12812.515512174901, 12814.244330639596, 12816.029997574906, 12817.872118653966, 12819.770286182897, 12821.724079100806, 12823.73306297978, 12825.796790024906, 12827.91479907426, 12830.086615598895, 12832.311751702853, 12834.589706123172, 12836.919964229864, 12839.301998025947, 12841.735192203585, 12844.21811098082, 12846.748816181216, 12849.325362368561, 12851.945804936653, 12854.608200811734, 12857.310609142543, 12860.05109197818, 12862.827714933666, 12865.638547843257, 12868.481665401434, 12871.355147791639, 12874.257081302796, 12877.185558933474, 12880.13868098383, 12883.114555635271, 12886.111299517808, 12889.127038265202, 12892.15990705779, 12895.208051153042, 12898.269626403851, 12901.342799764587, 12904.425749784792, 12907.516667090691, 12910.613754854377, 12913.715229250767, 12916.819319902219, 12919.924270310947, 12923.028338279111, 12926.12979631667, 12929.22693203695, 12932.318048539919, 12935.401464783214, 12938.475515940912, 12941.53855374998, 12944.588946844473, 12947.625081077493, 12950.645359830803, 12953.648204312267, 12956.632053840898, 12959.595366119767, 12962.536617496495, 12965.454303211613, 12968.346937634531, 12971.213054487336, 12974.051207056216, 12976.859968390692, 12979.637931490563, 12982.383709480535, 12985.095935772593, 12987.77326421618, 12990.41436923596, 12993.017945957425, 12995.582710320188, 12998.10739917899, 13000.590770392466, 13003.031602899617, 13005.42869678399, 13007.780873325644, 13010.086975040776, 13012.345865709156, 13014.556430389172, 13016.717575420715, 13018.828228415745, 13020.887338236562, 13022.893874961868, 13024.846829840453, 13026.745215232748, 13028.58806453996, 13030.37443212107, 13032.103393197423, 13033.774043745167, 13035.385500375336, 13036.936900201707, 13038.427400696366, 13039.856179533, 13041.222434417892, 13042.525382908749, 13043.764262221084, 13044.938329022494, 13046.046859214533, 13047.089147702445, 13048.064517876837, 13048.972858944337, 13049.814894699948, 13050.591411106097, 13051.303186494059, 13051.950991640437, 13052.5355898426, 13053.05773699302, 13053.518181652365, 13053.917665121684, 13054.25692151334, 13054.536677820888, 13054.75765398785, 13054.920562975354, 13055.026110828709, 13055.074996742847, 13055.067913126666, 13055.005545666223, 13054.888573386914, 13054.717668714457, 13054.493497534808, 13054.216719252998, 13053.887986850774, 13053.507946943238, 13053.077239834316, 13052.59649957113, 13052.066353997248, 13051.48742480493, 13050.860327586064, 13050.185671882226, 13049.46406123344, 13048.696093225992, 13047.882359538984, 13047.0234459899, 13046.119932579031, 13045.172393532772, 13044.181397345785, 13043.147506822144, 13042.071279115338, 13040.953265767095, 13039.794012745197, 13038.594060480149, 13037.353943900698, 13036.074192468363, 13034.755330210715, 13033.397875753648, 13032.00234235252, 13030.569237922145, 13029.099065065771, 13027.592321102833, 13026.049498095696, 13024.471082875272, 13022.857557065448, 13021.209397106559, 13019.527074277587, 13017.81105471739, 13016.061799444737, 13014.279764377292, 13012.465400349447, 13010.619153129068, 13008.741463433167, 13006.832766942362, 13004.893494314394, 13002.924071196376, 13000.924918236042, 12998.896451091807, 12996.839080441847, 12994.7532119919, 12992.639246482102, 12990.497579692674, 12988.328602448431, 12986.132700622327, 12983.910255137742, 12981.6616419698, 12979.387232145436, 12977.087391742501, 12974.762481887643, 12972.412858753167, 12970.038873552738, 12967.640872535965, 12965.219196981943, 12962.774183191652, 12960.306125562709, 12957.81507600639, 12955.300991531185, 12952.763830032343, 12950.20355054076, 12947.620113224908, 12945.0134793928, 12942.383611493848, 12939.73047312068, 12937.054029010882, 12934.354245048631, 12931.631088266404, 12928.884526846434, 12926.114530122277, 12923.321068580211, 12920.504113860596, 12917.663638759197, 12914.799617228402, 12911.912024378445, 12909.000836478464, 12906.0660309576, 12903.107586405986, 12900.125482575635, 12897.119700381361, 12894.09022190154, 12891.03703037888, 12887.960110221087, 12884.859447001469, 12881.735027459514, 12878.586839501371, 12875.414872200272, 12872.219115796895, 12868.999561699682, 12865.756202485069, 12862.489031897663, 12859.198044850353, 12855.883237424394, 12852.544606869362, 12849.182151603061, 12845.795871211458, 12842.385766448442, 12838.95183923553, 12835.494092661642, 12832.0125309826, 12828.507159620756, 12824.977985164469, 12821.42501536751, 12817.848259148426, 12814.247726589894, 12810.62342893787, 12806.97537860085, 12803.303589148938, 12799.608075312904, 12795.888852983173, 12792.14593920877, 12788.379352196143, 12784.589111308009, 12780.77523706205, 12776.937751129617, 12773.076676334349, 12769.192036650693, 12765.2838572024, 12761.352164260974, 12757.396985244017, 12753.418348713514, 12749.416284374107, 12745.390823071224, 12741.341996789235, 12737.269838649483, 12733.17438290824, 12729.055664954714, 12724.913721308798, 12720.748589618977, 12716.560308659979, 12712.348918330516, 12708.114459650847, 12703.85697476035, 12699.576506915004, 12695.273100484805, 12690.94680095114, 12686.597657290893, 12682.225740597993, 12677.831132990443, 12673.41391619956, 12668.97417146879, 12664.511979554618, 12660.027420727483, 12655.520574772587, 12650.991520990821, 12646.440338199578, 12641.867104733628, 12637.271898445917, 12632.654796708444, 12628.015876413032, 12623.355213972169, 12618.672885319796, 12613.968965912098, 12609.243530728312, 12604.496654271465, 12599.728410569165, 12594.938873174344, 12590.128115166035, 12585.296209150054, 12580.443227259799, 12575.569241156916, 12570.674322032057, 12565.758540605531, 12560.821967128073, 12555.86467138145, 12550.886722679195, 12545.888189867243, 12540.869141324622, 12535.82964496408, 12530.769768232736, 12525.689578112699, 12520.589141121725, 12515.468523313795, 12510.327790279754, 12505.16700714789, 12499.986238584517, 12494.785548794585, 12489.56500152221, 12484.324660051285, 12479.064587205989, 12473.784845351352, 12468.485496393805, 12463.16660178168, 12457.828222505737, 12452.470419099685, 12447.093251640685, 12441.69677974981, 12436.281062592574, 12430.846158879345, 12425.392126865896, 12419.919024353785, 12414.426908690824, 12408.915836771548, 12403.385865037611, 12397.83704947822, 12392.26944563054, 12386.683108580102, 12381.078092961217, 12375.45445295732, 12369.812242301385, 12364.151514276267, 12358.472321715091, 12352.774717001574, 12347.058752070372, 12341.32447840742, 12335.57194705027, 12329.801208588366, 12324.01231316339, 12318.205310469539, 12312.380249753814, 12306.537179816309, 12300.676149010484, 12294.797205243402, 12288.900395976023, 12282.98576777198, 12277.053359849013, 12271.103205867008, 12265.135339381208, 12259.14979399189, 12253.146603344283, 12247.125801128443, 12241.087421079179, 12235.031496975971, 12228.958062642832, 12222.86715194824, 12216.758798805042, 12210.633037170352, 12204.489901045428, 12198.329424475642, 12192.15164155031, 12185.956586402637, 12179.744293209611, 12173.5147961919, 12167.268129613765, 12161.00432778295, 12154.723425050604, 12148.42545581116, 12142.110454502259, 12135.778455604637, 12129.42949364204, 12123.063603181108, 12116.680818831312, 12110.281175244809, 12103.864707116387, 12097.431449183347, 12090.981436225415, 12084.51470306462, 12078.031284565217, 12071.5312156336, 12065.014531218185, 12058.481266309307, 12051.931455939142, 12045.365135181592, 12038.782339152185, 12032.183103008012, 12025.567461947567, 12018.935451210715, 12012.28710607854, 12005.62246187328, 11998.941553958202, 11992.244417737538, 11985.531088656344, 11978.801602200441, 11972.0559938963, 11965.294299310919, 11958.516554051774, 11951.722793766668, 11944.913054143686, 11938.087370911027, 11931.245779836989, 11924.38831672979, 11917.515017437525, 11910.625917848027, 11903.721053888814, 11896.800461526927, 11889.86417676889, 11882.912235660582, 11875.94467428713, 11868.96152877283, 11861.962835281032, 11854.948630014049, 11847.91894921306, 11840.873829157987, 11833.813306167427, 11826.737416598538, 11819.646196846916, 11812.539683346544, 11805.417912569645, 11798.280921026608, 11791.128745265894, 11783.961419738152, 11776.77896819612, 11769.581410993547, 11762.36876842167, 11755.141060710383, 11747.898308028283, 11740.64053048271, 11733.367748119823, 11726.079980924616, 11718.777248821008, 11711.459571671849, 11704.126969279003, 11696.779461383381, 11689.41706766498, 11682.039807742955, 11674.647701175647, 11667.240767460653, 11659.81902603484, 11652.38249627443, 11644.93119749501, 11637.465148951625, 11629.984369838781, 11622.488879290508, 11614.978696380424, 11607.453840121758, 11599.9143294674, 11592.360183309953, 11584.791420481792, 11577.208059755085, 11569.610119841842, 11561.997619393984, 11554.370577003368, 11546.729011201825, 11539.072940461245, 11531.402383193557, 11523.717357750827, 11516.017882425303, 11508.303975449413, 11500.57565499585, 11492.832939177617, 11485.075846048032, 11477.30439360082, 11469.518599770125, 11461.718482430555, 11453.904059397248, 11446.075348425873, 11438.232367212744, 11430.375133394762, 11422.503664549555, 11414.617978195458, 11406.718091791581, 11398.804022737839, 11390.875788375006, 11382.933405984744, 11374.976892789651, 11367.006265953309, 11359.021542580313, 11351.022739716302, 11343.009874348032, 11334.982963403401, 11326.942023751457, 11318.887072202502, 11310.81812550807, 11302.73520036102, 11294.638313395528, 11286.527481187144, 11278.402720252861, 11270.264047051105, 11262.111477981809, 11253.94502938644, 11245.764717548012, 11237.57055869118, 11229.362568971106, 11221.140763146368, 11212.905153370228, 11204.655751546876, 11196.392569634041, 11188.11561964293, 11179.824913638238, 11171.520463738112, 11163.202282114087, 11154.870380991126, 11146.524772647565, 11138.16546941505, 11129.79248367857, 11121.405827876386, 11113.005514500039, 11104.591556094294, 11096.16396525713, 11087.722754639706, 11079.26793694633, 11070.799524934451, 11062.317531414606, 11053.821969250423, 11045.312851358542, 11036.79019070866, 11028.254000323428, 11019.704293278493, 11011.141082702408, 11002.564381776649, 10993.974203735548, 10985.370561866328, 10976.753469508982, 10968.12294005633, 10959.47898695394, 10950.821623700103, 10942.150863845849, 10933.466720994862, 10924.769208803471, 10916.058340980622, 10907.334131287862, 10898.596593539292, 10889.845741601534, 10881.081589393707, 10872.304150887416, 10863.513440106695, 10854.709471127988, 10845.892258080105, 10837.061815144236, 10828.21815655385, 10819.361296594736, 10810.491249604927, 10801.608029974668, 10792.711652146418, 10783.802130614804, 10774.879479926562, 10765.943714680545, 10756.994849527684, 10748.03289917092, 10739.05787836523, 10730.069801917547, 10721.06868468676, 10712.054541583662, 10703.027387570919, 10693.98723766306, 10684.934106926406, 10675.868010479086, 10666.788963490946, 10657.696981183592, 10648.59207883027, 10639.4742717559, 10630.34357533466, 10621.199999822167, 10612.0435394102, 10602.874185247387, 10593.691928580116, 10584.496760752556, 10575.288673206689, 10566.067657482296, 10556.833705217015, 10547.586808146332, 10538.326958103615, 10529.054147020146, 10519.768366925104, 10510.469609945638, 10501.157868306842, 10491.833134331791, 10482.495400441594, 10473.14465915536, 10463.780903090259, 10454.40412496153, 10445.014317582527, 10435.611473864685, 10426.19558681761, 10416.76664954907, 10407.324655264993, 10397.869597269542, 10388.401468965105, 10378.920263852331, 10369.425975530157, 10359.918597695798, 10350.398124144824, 10340.864548771156, 10331.317865567107, 10321.758068623352, 10312.185152129037, 10302.599110371742, 10292.999937737544, 10283.387628711014, 10273.762177875256, 10264.123579911933, 10254.471829601303, 10244.806921822215, 10235.12885155219, 10225.437613867372, 10215.733203942636, 10206.015617051547, 10196.284848566449, 10186.540893958432, 10176.783748797412, 10167.013408752118, 10157.229869590152, 10147.433127178001, 10137.62317748108, 10127.80001656373, 10117.963640589287, 10108.114045820086, 10098.251228617488, 10088.375185441933, 10078.485912852952, 10068.583407509199, 10058.667666168485, 10048.73868568781, 10038.796463023384, 10028.84099523068, 10018.872279464418, 10008.890312978678, 9998.89508890621, 9988.886575899971, 9978.864734009041, 9968.829523616669, 9958.7809054526, 9948.718840593061, 9938.643290460737, 9928.55421682475, 9918.451581800673, 9908.335347850458, 9898.205477782481, 9888.0619347515, 9877.904682258595, 9867.733684151215, 9857.548904623109, 9847.350308214343, 9837.137859811248, 9826.911524646417, 9816.671268298676, 9806.41705669307, 9796.148856100832, 9785.866633139369, 9775.570354772222, 9765.259988309059, 9754.935501405638, 9744.596862063805, 9734.244038631437, 9723.876999802435, 9713.495714616683, 9703.10015246006, 9692.690283064352, 9682.266076507278, 9671.827503212427, 9661.374533949247, 9650.907139833014, 9640.425292324797, 9629.928963231418, 9619.418124705437, 9608.892749245144, 9598.352809694452, 9587.79827924294, 9577.2291314258, 9566.645340123769, 9556.046879563153, 9545.433724315728, 9534.805849298762, 9524.163229774946, 9513.505841352384, 9502.833659984515, 9492.146661970131, 9481.444823953294, 9470.728122923327, 9459.996536214752, 9449.250041507268, 9438.48861682571, 9427.712240540019, 9416.920891365164, 9406.114548361144, 9395.293190932925, 9384.456798830412, 9373.605352140648, 9362.738814338702, 9351.857096472095, 9340.9600999884, 9330.047727050716, 9319.119880537739, 9308.176464043812, 9297.21738187906, 9286.242539069384, 9275.251841356618, 9264.24519519854, 9253.222507768996, 9242.183686957975, 9231.1286413717, 9220.057280332683, 9208.969513879856, 9197.865252768668, 9186.74440847112, 9175.606893175953, 9164.452619788644, 9153.281501931597, 9142.093453944195, 9130.888390882934, 9119.666228521493, 9108.42688335089, 9097.17027257957, 9085.896314133515, 9074.604926656364, 9063.296029509549, 9051.96954277239, 9040.625387242235, 9029.263484434585, 9017.883756583205, 9006.486126640279, 8995.070518276516, 8983.636855881308, 8972.185064562842, 8960.715070148246, 8949.226799183767, 8937.72017893484, 8926.195137386296, 8914.651603242479, 8903.089505927399, 8891.508775584898, 8879.909343078774, 8868.291139992978, 8856.654098631727, 8844.99815201969, 8833.323233902154, 8821.629278745173, 8809.916221735746, 8798.183998781964, 8786.43254651322, 8774.661802280349, 8762.871704155808, 8751.062190933873, 8739.233202058078, 8727.384625067107, 8715.516203421013, 8703.627657813535, 8691.71871115354, 8679.789088564903, 8667.838517386335, 8655.866727171197, 8643.87344968734, 8631.858418916909, 8619.821371056096, 8607.762044514964, 8595.680179917183, 8583.575520099796, 8571.447810112955, 8559.296797219657, 8547.122230895438, 8534.923862828115, 8522.701446917441, 8510.454739274794, 8498.18349822286, 8485.887484295283, 8473.566460236267, 8461.22019100027, 8448.848443751573, 8436.450987863904, 8424.027594920022, 8411.57803871131, 8399.102095237335, 8386.59954270538, 8374.070161530044, 8361.513734332715, 8348.930045941119, 8336.318883388803, 8323.680035914664, 8311.01329496239, 8298.318454179958, 8285.59530941908, 8272.843658734639, 8260.063302384131, 8247.254042827079, 8234.41568472444, 8221.548034938001, 8208.650902529758, 8195.724098761293, 8182.767437093117, 8169.780733184038, 8156.763804890463, 8143.716472265732, 8130.638557559441, 8117.529885216703, 8104.390279281407, 8091.219448594429, 8078.016942255673, 8064.782301327186, 8051.5150708701985, 8038.214799944996, 8024.881041610695, 8011.513352925129, 7998.1112949446415, 7984.674432723975, 7971.202335316058, 7957.6945757719295, 7944.150731140538, 7930.570382468638, 7916.95311480064, 7903.2985171784985, 7889.606182641573, 7875.875708226521, 7862.106694967176, 7848.298747894445, 7834.451476036207, 7820.5644924171975, 7806.637414058949, 7792.669861979666, 7778.661461194151, 7764.611840713732, 7750.520633546189, 7736.387476695677, 7722.212011162654, 7707.993881943835, 7693.732738032134, 7679.428232416608, 7665.080022082403, 7650.687768010741, 7636.25113517884, 7621.76979255993, 7607.24341312319, 7592.671673833747, 7578.054255652647, 7563.3908435368485, 7548.681126439215, 7533.924797308501, 7519.121553089384, 7504.2710947224305, 7489.37312714414, 7474.427357074062, 7459.432910061242, 7444.3875538342945, 7429.288879171995, 7414.134495844729, 7398.922032615861, 7383.64913724324, 7368.313476480901, 7352.912736080918, 7337.444620795503, 7321.906854379204, 7306.297179591331, 7290.613358198557, 7274.853170977691, 7259.014417718627, 7243.094917227477, 7227.092507329885, 7211.00504487452, 7194.830405736764, 7178.566484822522, 7162.2111960723105, 7145.762472465407, 7129.218266024294, 7112.576547819193, 7095.835307972829, 7078.992555665361, 7062.0463191394865, 7044.994645705731, 7027.835601747908, 7010.56727272878, 6993.187763195885, 6975.695196787524, 6958.0877162389625, 6940.363483388804, 6922.520679185521, 6904.557503694175, 6886.472176103335, 6868.262934732167, 6849.928037037679, 6831.465759622153, 6812.874428393595, 6794.152578165146, 6775.29883520312, 6756.3118431290095, 6737.1902627468735, 6717.932772036374, 6698.53806614564, 6679.00485738382, 6659.331875213415, 6639.517866242321, 6619.561594215657, 6599.461840007288, 6579.21740161114, 6558.82709413224, 6538.289749777475, 6517.604217846142, 6496.769364720216, 6475.784073854348, 6454.647245765664, 6433.357798023216, 6411.91466523727, 6390.31679904831, 6368.563168115714, 6346.652758106308, 6324.584571682547, 6302.3576284905075, 6279.970965147576, 6257.423635229939, 6234.71470925978, 6211.843274692207, 6188.808435901963, 6165.609314169864, 6142.245047668961, 6118.713400460026, 6094.995528997528, 6071.061800233069, 6046.882638757908, 6022.428721636985, 5997.670978412096, 5972.580591109937, 5947.128994254802, 5921.2878748861685, 5895.029172580943, 5868.325079480583, 5841.1480403229025, 5813.470752478718, 5785.26616599319, 5756.507483632031, 5727.168160932384, 5697.2219062585655, 5666.642680862495, 5635.404698948964, 5603.4824277456355, 5570.850587577829, 5537.484151948075, 5503.358347620434, 5468.448654709603, 5432.730806774786, 5396.1807909183035, 5358.774847889043, 5320.494144455441, 5281.3510560986115, 5241.370523571145, 5200.577364540812, 5158.996235988435, 5116.651634068711, 5073.567893976158, 5029.769189815951, 4985.279534479874, 4940.12277952719, 4894.322615070604, 4847.902569667202, 4800.886010214396, 4753.296141850876, 4705.156007862613, 4656.488489593831, 4607.316306363033, 4557.662015383953, 4507.548011691656, 4456.996528073528, 4406.003013747047, 4354.074719521878, 4300.29576336354, 4243.744040547118, 4183.505837671011, 4118.675834488639, 4048.3571067232424, 3971.661129865632, 3887.7077839550343, 3795.625359342898, 3694.5505634398596, 3583.6285284456017, 3462.012820061857, 3328.8654471883124, 3183.3568726017434, 3024.666024617987, 2851.9803097371005, 2664.4956262713495, 2461.416378956535, 2241.955494546076, 2005.3344383882968]

# Moment distribution function --------------------------------------------------------------

def getMomentDistr(Ldistr):
    Ldistr[0] = 0
    Ldistr.append(0)
    LdistrArr = -1 * np.array(Ldistr)
    Ldistr = list(LdistrArr)

    # Input variables
    L = b/2  # half wing span
    Lmax = 2500
    npoints = len(Ldistr) - 1
    dy = L / npoints

    # Find p position
    Ppos = round(0.35 * npoints)

    def p(n, Ppos):
        if n == Ppos:
            return 20267
        else:
            return 0


    # Calculate wing weight along y
    def W_w(y):
        return 391.2366 * (-0.215585 * y + 3.695654)

    W_w_distr = []
    for n in range(npoints + 1):
        W_w_distr.append(W_w((L / npoints) * n))
    W_w_distr[0] = 0
    W_w_distr[npoints] = 0

    halfWingWeight, error = sp.integrate.quad(W_w, 0, L)
    #print(halfWingWeight)
    
    # Calculate shear
    sumdistr = []
    for n in range(npoints + 1):
        sumdistr.append((W_w_distr[n] + Ldistr[n]))

    shear_internal_distr = []
    for n in range(npoints + 1):
        sum_integral = []
        for n_1 in range(n, npoints + 1):
            sum_integral.append((sumdistr[n_1] * dy + p(n_1, Ppos)))
        sum_contribution = sum(sum_integral)
        shear_internal_distr.append(sum_contribution)

    moment_internal_distr = []
    for n in range(npoints + 1):
        sum_integral = []
        for n_1 in range(n, npoints + 1):
            sum_integral.append((shear_internal_distr[n_1] * dy))
        sum_contribution = sum(sum_integral)
        moment_internal_distr.append(sum_contribution)

    # Make graphs
    ytab = []
    for n in range(npoints + 1):
        ytab.append(n)

    return moment_internal_distr

# Calculations of length, area & centroid ---------------------------------------------------

# Creating the steps and interval. This will decide the level
#   of detail of the calculations
y = np.linspace(0, b/2, points)
n_points = len(y)
C_y = C_r + C_t * (y/(b/2)) - C_r * (y/(b/2))   # Chord as function of y    [m]
ylst = y.tolist()

# Calculating the neutral axis, dividing the wing box plates into 4 parts
# Part length       [m]
L_I = (x_rearspar - x_frontspar) * C_y 
L_II = h_rearspar * C_y
L_IV = h_frontspar * C_y
L_III = np.sqrt( (L_IV-L_II)**2 + L_I**2)

# Part area         [m^2]
A_I = L_I * t_sheet
A_II = L_II * t_sheet
A_III = L_III * t_sheet
A_IV = L_IV * t_sheet

# Part centroid     [m]
z_I = L_IV
z_II = L_IV - 0.5*L_II
z_III = 0.5 * (L_IV - L_II)
z_IV = 0.5 * L_IV

# Calculating the moment of inertia for the stringers----------------------------------------

n_iterations = len(y)

# Top stringers
y_n = 0
n_strlist_top = []

# This loop computes the # of stringers at each y coord
for i in range(n_iterations):
    n_str_y_n = len(topstr(y_n/(b/2))[topstr(y_n/(b/2)) != 0])
    y_n += step
    n_strlist_top.append(n_str_y_n)

n_str_top = np.array(n_strlist_top)

# Bottom stringers
y_n = 0
n_strlist_bot = []

# This loop computes the # of stringers at each y coord
for i in range(n_iterations):
    n_str_y_n = len(botstr(y_n/(b/2))[botstr(y_n/(b/2)) != 0])
    y_n += step
    n_strlist_bot.append(n_str_y_n)

n_str_bot = np.array(n_strlist_bot)

# z-coordinate of neutral axis, as seen from the bottom of the front spar
z_n = (A_str*(n_str_top)*z_I + A_str*(n_str_bot)*z_III + A_I*z_I + A_II*z_II + A_III*z_III + A_IV*z_IV) / (A_I + A_II + A_III + A_IV + A_str*(n_str_top+n_str_bot))

# Stringer MOI
I_str_bot = n_str_bot * A_str * (z_I-z_n)**2
I_str_top = n_str_top * A_str * (z_I-z_n)**2

# Calculating the moment of inertia for the sheets-------------------------------------------


# Parts 1, 2 and 4
I_I = L_I * t_sheet**3 * (1/12) + A_I * (z_I-z_n)**2
I_II = t_sheet * L_II**3 * (1/12) + A_II * (z_II-z_n)**2
I_IV = t_sheet * L_IV**3 * (1/12) + A_IV * (z_IV-z_n)**2

# Part 3 is slanted
I_III_x = L_III * t_sheet**3 * (1/12)
I_III_y = t_sheet * L_III**3 * (1/12)
theta_III = np.tan((L_IV-L_II)/L_I)

I_III = I_III_x * np.cos(theta_III)**2 + I_III_y * np.sin(theta_III)**2 + A_III * (z_III-z_n)**2

# Final MOI         [m^4]
I = I_I + I_II + I_III + I_IV + I_str_top + I_str_bot
I_lst = np.array(I).tolist()
AMOI = sp.interpolate.interp1d(y,I_lst,kind='cubic',fill_value='extrapolate')
I_plot = np.array(AMOI(y))

def I_y(y):
    return AMOI(y)

# OUTPUT: Moment of inertia as a function of y: I_y(y) 
print('MOI done')

# Calculating the torsional constant --------------------------------------------------------


A_encl = L_I*L_II + (L_IV-L_II)*L_I*0.5 - A_str*(n_str_bot+n_str_top) # Enclosed area [m^2]
ds_t = (L_I+L_II+L_III+L_IV) / t_sheet          # Integral of the reciprocal of t and length

J = 4 * A_encl**2 / ds_t                        # Torsional constant
T_C = sp.interpolate.interp1d(y,J,kind='cubic',fill_value='extrapolate')
J_plot = np.array(T_C(y))

def J_y(y):
    return T_C(y)

# OUTPUT: Torsional constant as a function of y: J_y(y)
print('J done')

# This section will be deleted once the moment and torque function is available -------------
''' The moment and torque functions can be inputted in this program as a list of values
Should it have another format, that doesn't have to be a problem but a little bit of
additional code will be required. '''

# Making a fake lift distribution
def L_prime(y):
    return 12467

def L(y):
    return L_prime(0)*b/2


Mlst = []

for i in range(n_iterations):
    M = sp.integrate.quad(L, ylst[i], (b/2))
    Mlst.append(M[0])

# Fake moment distribution:
#M = np.array(Mlst)
M = getMomentDistr(Ldistr)
M = np.array(M)
print('Fake calculations done')

# Fake torque distibution
T = 200
Tlst = []

for i in range(n_iterations):
    Tlst.append(T)

T = np.array(Tlst)

# Calculating deflection --------------------------------------------------------------------


# Retrieving -M/EI
MEI = M/(E*I)

# First integration
MEIfunc = sp.interpolate.interp1d(y,MEI,kind='cubic',fill_value='extrapolate')
dvdylst = []

for i in range(n_iterations):
    dvdy = sp.integrate.quad(MEIfunc, ylst[i], (b/2))
    dvdylst.append(dvdy[0])

dvdy = np.array(dvdylst)

# Adding integration constant (because dvdy(0) = 0)
C_1 = -dvdy[0]
dvdy += C_1

print('First integration done')
# Second integration
dvdyfunc = sp.interpolate.interp1d(y,dvdy,kind='cubic',fill_value='extrapolate')
vlst = []

for i in range(n_iterations):
    v = sp.integrate.quad(dvdyfunc, ylst[i], (b/2))
    vlst.append(v[0])

v = np.array(vlst)

# Adding integration constant (because v(0) = 0)
C_2 = -v[0]
v += C_2
print('Second integration done')

# Calculating twist -------------------------------------------------------------------------


# Retrieving T/GJ
TGJ = T/(G*J)

# Integration
TGJfunc = sp.interpolate.interp1d(y,TGJ,kind='cubic',fill_value='extrapolate')
philst = []

for i in range(n_iterations):
    phi = sp.integrate.quad(TGJfunc, ylst[i], (b/2))
    philst.append(phi[0])

phi = np.array(philst)

# Adding integration constant (phi(0) = 0)

C_3 = -phi[0]
phi += C_3
print('Twist integration done')

# Statistics --------------------------------------------------------------------------------
v_max = -np.amin(v)
v_percentage = v_max/b * 100
phi_max = abs(-np.amin(phi) * 180 / math.pi)

print('The maximum deflection is', round(v_max, 4), '[m] or', round(v_percentage, 3), '[%] of the span.')
print('The maximum twist is', round(phi_max, 4),'[deg]')
print("Calculations took %s seconds." % round((time.time() - start_time), 2))
plt.plot(y, v)
plt.plot(y, dvdy)
plt.plot(y, I)
plt.plot(y, phi)
#plt.plot(y, M)
plt.show()
